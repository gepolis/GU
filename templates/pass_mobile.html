<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Госуслуги - Паспорт РФ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        body {
            background-color: #f5f5f7;
            color: #333;
            line-height: 1.5;
        }
        .dark-mode {
            background-color: #000;
        }

        .container {
            max-width: 100%;
            padding: 12px;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            margin-bottom: 16px;
        }
        .dark-mode .header {
            color: #FFF2F5;
        }


        .header-left {
            display: flex;
            align-items: center;
        }

        .back-button {
            margin-right: 16px;
            font-size: 24px;
            color: #000;
        }

        .dark-mode i {
            color: #898697;
            font-weight: 700;
        }

        .title {
            font-size: 20px;
            font-weight: 600;
        }

        .share-button {
            position: relative;
            width: 24px;
            height: 24px;
        }

        .passport-card {
            background-color: white;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        body .passport-header {
            background-color: #9b1327;
            color: white;
            padding: 12px 16px;
            text-align: center;

            font-family: 'Times New Roman', serif !important;
            font-size: 14px;
            font-weight: 300;
        }

        .passport-content {
            padding: 16px;
            background-color: #f5e7e7;
            display: flex;
        }

        .passport-photo {
    width: 130px;
    height: 180px;
    background-color: #eee;
    border: 1px solid #ddd;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border-radius: 14px;
    margin-left: 16px;
}

        .passport-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .passport-data {
            margin-left: 16px;
            flex: 1;
        }

        .passport-number {
            font-size: 18px;
            font-weight: bold;
            color: #8d172f;
            margin-bottom: 8px;
        }

        .issued-by {
            font-size: 14px;
            color: #666;
            margin-bottom: 16px;
        }

        .details-row {
            display: flex;
            margin-bottom: 12px;
        }

        .detail-column {
            flex: 1;
        }

        .detail-label {
            font-size: 14px;
            color: #666;
            line-height: 1.2;
        }

        .detail-value {
            font-size: 14px;

        }


        .full-width {
            width: 100%;
            margin-bottom: 12px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin: 24px 0 12px;
        }

        .menu-item {
            background-color: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .menu-item-text {
            display: flex;
            align-items: center;
        }

        .menu-item-icon {
            margin-right: 12px;
            color: #3366ff;
            font-size: 20px;
        }

        .menu-item-arrow {
            color: #999;
        }

        .passport-footer {
            padding: 16px;
            text-align: center;
            border-top: 1px solid #eee;
        }

        .passport-link {
            color: #3366ff;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
        }
        a {
        text-decoration: none;
        }
        .passport-number i {
            color: #8d172f;
        }
.passport-left-column {
    display: flex;
    flex-direction: column;
    margin-right: 16px;
    flex-shrink: 0;
    width: 120px;
    padding-left: 0; /* Убираем внутренний отступ слева */
    margin-left: 0; /* Убираем внешний отступ слева */
}

.passport-emblem {
    display: flex;
    justify-content: flex-start;
    padding-left: 0; /* Убираем внутренний отступ слева */
    margin-left: 0; /* Убираем внешний отступ слева */
}

.passport-emblem img {
    width: 120px; /* Полная ширина колонки */
    height: calc(100% - 26px);
    object-fit: contain;
    margin-left: 0; /* Убираем отступ слева у изображения */
    padding-left: 0; /* Убираем внутренний отступ */
    align-self: flex-start;
}

/* Убедитесь, что у passport-content нет лишних отступов */
.passport-content {
    padding: 16px;
    background-color: #f5e7e7;
    display: flex;
    padding-left: 0; /* Добавьте это, если нужно убрать отступ слева у всего контента */
    margin-left: 0; /* Добавьте это, если нужно убрать внешний отступ */
}
        .copy-icon {
            color: #3366ff;
            width: auto;
            height: 16px;
            margin-left: 4px;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <a class="back-button" href="/"><i class="fas fa-arrow-left fa-xs" style="width: 20px; height: 20px;"></i></a>
                <div class="title">Паспорт РФ</div>
            </div>
            <div class="share-button" onclick="sharePassport()">
                <i class="fas fa-share"></i>
            </div>
        </div>

        <div class="passport-card">
            <div class="passport-header"><b>РОССИЙСКАЯ ФЕДЕРАЦИЯ</b></div>

            <div class="passport-content">
                <div class="passport-left-column">
        <div class="passport-photo">
            <img src="photo.png" alt="Фото владельца" id="photoPreview">
        </div>
        <div class="passport-emblem">
            <img src="static/emblem.jpg" alt="Герб России">
        </div>
    </div>

                <div class="passport-data">
                    <div class="passport-number" id ="passportNumber">45 24 555555 <i class="fas fa-copy"></i></div>

                    <div class="details-row">
                        <div class="detail-column">
                            <div class="detail-label">Кем выдан</div>
                            <div class="detail-value" id ="passportIssued">ГУ МВД РОССИИ ПО Г. МОСКВА</div>
                        </div>
                    </div>

                    <div class="details-row">
                        <div class="detail-column">
                            <div class="detail-label">Дата выдачи</div>
                            <div class="detail-value" id ="passportDate">15.04.2023</div>
                        </div>
                        <div class="detail-column">
                            <div class="detail-label">Код подразделения</div>
                            <div class="detail-value" id ="passportCode">770-077</div>
                        </div>
                    </div>

                    <div class="full-width">
                        <div class="detail-label">ФИО</div>
                        <div class="detail-value" id ="fn">ИВАНОВ ИВАН ИВАНОВИЧ</div>
                    </div>


                    <div class="details-row">
                        <div class="detail-column">
                            <div class="detail-label">Пол</div>
                            <div class="detail-value" id ="gender">МУЖ</div>
                        </div>
                        <div class="detail-column">
                            <div class="detail-label">Дата рождения</div>
                            <div class="detail-value" id ="birthDate">15.04.1985</div>
                        </div>
                    </div>

                    <div class="full-width">
                        <div class="detail-label">Место рождения</div>
                        <div class="detail-value" id ="birthPlace">РОССИЯ МОСКВА</div>
                    </div>

                    <div class="full-width">
                        <br>
                        <a href="/mobile/details" class="passport-link">Детали документа</a>
                    </div>
                </div>
            </div>


        </div>

    </div>

    <script>
function toggleDarkMode() {
            const currentHour = new Date().getHours();
            const body = document.body;

            if (currentHour >= 18 || currentHour < 6) {
                body.classList.add('dark-mode');
            } else {
                body.classList.remove('dark-mode');
            }
        }

        // Вызов функции при загрузке страницы
toggleDarkMode();
// Опционально: можно установить таймер для проверки каждые 30 минут
setInterval(toggleDarkMode, 15 * 60 * 1000); // каждые 30 минут
const user_id = localStorage.getItem('user_id');
const profileCache = localStorage.getItem('profileCache');
function loadCache() {
    if (profileCache) {
        const profile = JSON.parse(profileCache);
        console.log("Start cache")
        document.getElementById('fn').innerHTML = (profile.lastName + ' ' + profile.firstName + '<br>' + profile.middleName || '').toUpperCase();
        document.getElementById('birthDate').innerText = profile.birthDate || '';
        document.getElementById('birthPlace').innerText = profile.birthPlace || '';
        document.getElementById('passportNumber').innerHTML = profile.passportNumber+" <img src='static/copy.jpg' class='copy-icon'>" || '';
        document.getElementById('passportIssued').innerText = profile.passportIssued || '';
        document.getElementById('passportCode').innerText = profile.passportCode || '';
        document.getElementById('passportDate').innerText = profile.passportDate || '';
        document.getElementById('photoPreview').src = profile.photoInput || (profile.gender[0] === 'М' ? 'static/men.jpg' : 'static/women.jpg');
        document.getElementById('gender').innerText = profile.gender.toUpperCase() || 'МУЖСКОЙ';
        console.log("End cache")
    }
}
if (!user_id) {
    window.location.href = '/auth';
}
function getProtocolAndIP() {
    const protocol = window.location.protocol;   // "http:" или "https:"
    const host = window.location.host;           // "localhost:5000" или "127.0.0.1:5000"
    return `${protocol}//${host}`;
}
API_URL = getProtocolAndIP() + '/api';
async function loadProfile(profileId) {

                console.log("Fetch data")
                const response = await fetch(`${API_URL}/profile?user_id=${user_id}&profile_id=${localStorage.getItem('currentProfileId')}`);
                const profile = await response.json();
                localStorage.setItem('profileCache', JSON.stringify(profile));
                console.log("Fetch data end")

                console.log(profile)
                document.getElementById('fn').innerHTML = (profile.lastName + ' ' + profile.firstName + '<br>' + profile.middleName || '').toUpperCase();
                document.getElementById('birthDate').innerText = profile.birthDate || '';
                document.getElementById('birthPlace').innerText = profile.birthPlace || '';
                document.getElementById('passportNumber').innerHTML = profile.passportNumber+" <img src='static/copy.jpg' class='copy-icon'>" || '';
                document.getElementById('passportIssued').innerText = profile.passportIssued || '';
                document.getElementById('passportCode').innerText = profile.passportCode || '';
                document.getElementById('passportDate').innerText = profile.passportDate || '';
                //load gender
                document.getElementById('gender').innerText = profile.gender.toUpperCase() || 'МУЖСКОЙ';
                document.getElementById('photoPreview').src = profile.photoInput || (profile.gender[0] === 'М' ? 'static/men.jpg' : 'static/women.jpg');
                console.log("END")

                //console.log(profile.photoInput)
                //photoPreview.innerHTML = `<img src="${profile.photoInput}" alt="Фото профиля">`;

        }
async function sharePassport() {
    const profile = JSON.parse(localStorage.getItem('profileCache') || '{}');

    // Формируем текст для分享
    const shareText = `Паспорт РФ\n\n` +
                     `ФИО: ${profile.lastName} ${profile.firstName} ${profile.middleName || ''}\n` +
                     `Номер: ${profile.passportNumber}\n` +
                     `Дата выдачи: ${profile.passportDate}\n` +
                     `Кем выдан: ${profile.passportIssued}`;

    try {
        // Пытаемся использовать Web Share API если доступен
        if (navigator.share) {
            await navigator.share({
                title: 'Данные паспорта РФ',
                text: shareText,
                // url: window.location.href, // можно добавить ссылку
            });
        } else {
            // Fallback для браузеров без Web Share API
            await navigator.clipboard.writeText(shareText);
            alert('Данные паспорта скопированы в буфер обмена');
        }
    } catch (err) {
        console.error('Ошибка при попытке поделиться:', err);
        // Дополнительный fallback
        const textarea = document.createElement('textarea');
        textarea.value = shareText;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('Данные паспорта скопированы в буфер обмена');
    }
}

document.getElementById('passportNumber').addEventListener('click', function() {
    let number = document.getElementById('passportNumber').innerText;
    navigator.clipboard.writeText(number);
});

        loadCache();
        loadProfile(localStorage.getItem('currentProfileId'));
    </script>
</body>
</html>